name: "CodeQL Security Analysis"

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # Optional: schedule a weekly scan
    - cron: '0 3 * * 1'

jobs:
  codeql-analysis:
    name: Analyze Java Code
    runs-on: ubuntu-latest

    permissions:
      # Required to upload results to the GitHub Security tab
      security-events: write
      actions: read

    steps:
      # Step 1: Checkout the repository (Updated to v4)
      - name: Checkout repository
        uses: actions/checkout@v4 
      
      # Step 2: Initialize CodeQL (Updated to v3)
      # This downloads CodeQL and hooks into the compiler (javac).
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: java
          # Using the standard security and quality queries
          queries: security-and-quality

      # Step 3: Manual Build/Compile the Java file (Fixed from previous runs)
      # This step must successfully generate the .class file for CodeQL to analyze.
      - name: Compile FileChecksum.java
        run: |
          # The fix for the illegal character (\u00a0) must be applied to your source file first!
          javac FileChecksum.java

      # Step 4: Perform Analysis (Updated to v3)
      # This runs the queries on the database created during the build and automatically
      # uploads the results (SARIF file) to the Security tab.
      - name: Run CodeQL Analysis
        uses: github/codeql-action/analyze@v3
